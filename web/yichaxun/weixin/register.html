<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>注册</title>
    <link rel="stylesheet" href="css/login.css"/>
    <link rel="stylesheet" href="css/pop_p.css"/>
    <script src="js/jquery-3.0.0.min.js"></script>
    <!--<script src="js/vconsole.min.js"></script>-->
    <style>
        input{
            outline:none;
        }
        body{
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select:none;
        }
        body{
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0);
            -moz-user-select: none;
            -webkit-appearance:none;
            outline: none;
            overflow: hidden;
        }
        .miss{
            display: none;
        }
        input{
            font-size: 17px !important;
            color: #000000 !important; ;
        }
        button{
            font-size: 17px !important;
        }
        .button_register_next:hover{
            background-color: #04BE02;
        }
    </style>
</head>
<body>
<!--注册界面-->
<div id="register_box" class="register_box"  >
    <!--<div class="login_top_register">-->
    <!--<img src="icon/back-arrow.png" alt="" class="back"/>-->
    <!--<span class="login_top_register_p ">注册</span>-->
    <!--</div>-->
    <div class="input_box_register">
        <input id="phone" class="phone" type="text" style="width: 90%"/>
        <span class="placeholder_phone">请输入手机号码</span>
        <div class="phone_img">
            <img class="img" style="width: 15px" src="icon/shouji@2x.png" alt=""/>
        </div>
    </div>
    <div class="input_box_register_change" >
        <input id="changeVerification_register" class="changeVerification_register"style="width: 50%" type="text"/>
        <span class="placeholder_changeVerification_register">请输入验证码</span>
        <button class="send_Verification_change_a" style="right: 0;padding: 0;border: 0;background: #ffffff"><span class="changeCode" style="color: #4179ce">发送验证码</span></button>
    </div>
    <div class="clear"></div>
    <div class="input_box_register">
        <input id="password" class="password"style="width: 90%" type="password"/>
        <span class="placeholder_password">请输入密码（至少六位数）</span>
        <div class="password_img">
            <img class="img" style="width: 15px" src="icon/suo111@2x.png" alt=""/>
        </div>
        <div class="eye">
            <img style="width: 25px" class="img" src="icon/eye-lose2@2x.png" alt=""/>
        </div>
        <div class="clear"></div>


    </div>
    <div class="button_register">
        <!--<input class=" button_register_next"  type="button" value="注册"/>-->
        <button class=" button_register_next " disabled  >注册</button>
        <!--<div class="lf wenzi"><a class="lf register" href="">注册账号</a> <a class="rt forget_pass" href="">忘记密码</a></div>-->
    </div>
    <div class="clear"></div>
    <div class="bottom_gouxuan" style="position: relative;width: 100%">
        <div class="gouxuan" style="text-align: center;margin-top: 20px">
            <img class="img_gouxuan" style="width: 16px" src="icon/gouxuan@2x.png" alt=""/>
            <span class="gouxuan_tiaokuan">我已阅读并同意<a href="http://passion.njshangka.com/yichaxun/medicalSearch/protocol.html" style="color: #4179ce;">用户协议</a></span>
        </div>

    </div>
    <div style="width: 100%;text-align: center;position:relative;top:160px;left: 0">
        <p style="font-size: 16px;color: #999">已有账号，请前往<span class="refresh_login" style="color: #ff0000">登录</span></p>
    </div>
</div>
<!--弹窗-->
<div class="tanchuang1" style="display: none">
    <span class="wenzi"></span>
    <span class="btnbtn">OK</span>
</div>

<script>
    $('.btnbtn').click(function(){
        $('.tanchuang1').css('display','none');
    })
</script>
<!--登录界面-->
<script>

    //监听input是否有内容，有内容span取消
    $('input').focus(function(){
        $(this).next().css('display','none');
    });
    $('input').blur(function(){
        if($(this).val()==''){
            $(this).next().css('display','block');
        }
    });
    //todo 判断登录输入
    $().ready(function(){

        var passW= localStorage.clear('passW');
        var phoneW=localStorage.clear('phoneW');
        $('#login_name').val("")
        $('#login_password').val("")
        console.log(passW,phoneW)
        console.log( $('#login_name').val(),$('#login_password').val())
//    $('.button_next').attr({"disabled":true}).css('background-color','#d1d5da');
        //监听input是否有内容，有内容span取消
        $('input').focus(function(){
            $(this).next().css('display','none');
        });
        $('input').blur(function(){
            if($(this).val()==''){
                $(this).next().css('display','block');
            }
        });
//    $("#login_password").val("");
//    console.log("mmmm="+$("#login_password").val());

    })




    $('#login_name').bind('input propertychange', function(){
        var a = $("#login_name").val();
//        var reg=/^0?(13[0-9]|15[012356789]|18[0123456789]|14[57])[0-9]{8}$/ ;
        if(a.length==11){
            var b = $("#login_password").val();
//            var asd=$("#login_name").val();
            if(b.length>=6){
                console.log("dayu6")
                $('.button_next').css('background-color','#4179ce').attr('disabled',false)
            }
            else{
                console.log("xiaoyu6")
//                $('.button_next').attr({"disabled":true}).css('background-color','#d1d5da');
            }

        }
        else{
            console.log("asdasdasd")
            $('.button_next').attr({"disabled":true}).css('background-color','#d1d5da');
        }
    });
    $('#login_password').bind('input propertychange', function(){
        var b = $("#login_password").val();
        var asd=$("#login_name").val();
        if(b.length>=6&&asd.length==11){
            console.log("dayu6")
            $('.button_next').css('background-color','#4179ce').attr('disabled',false)
        }
        else{
            console.log("xiaoyu6")
            $('.button_next').attr({"disabled":true}).css('background-color','#d1d5da');
        }
    });


    //todo 注册界面判断输入值
    $('#phone').bind('input propertychange', function(){
        var a = $("#phone").val();
//        var reg=/^0?(13[0-9]|15[012356789]|18[0123456789]|14[57])[0-9]{8}$/ ;
        if(a.length==11){


//                $('#Verification').bind('input propertychange', function() {
//                    var c = $("#Verification").val();
//                    console.log($('#Verification').val())
//                    if ($('#Verification').val() != '') {
//                        console.log("dadadadadadad")
            $('#password').bind('input propertychange', function(){
                var b = $("#password").val();
                if(b.length>=6){
                    console.log("dayu6");
                    $('.button_register_next').attr({"disabled":false}).css('background-color', '#4179ce');
                }else {
                    console.log("xiaoyu6");
                    $('.button_register_next').attr({"disabled":true}).css('background-color', '#d1d5da');
                }
            })
        }
        else{
            console.log("kongkong")
            $('.button_register_next').attr({"disabled":true}).css('background-color','#d1d5da');
//                    }
//                })
//            }else{
//        console.log("asdasdasd")
//        $('.button_register_next').attr({"disabled":true}).css('background-color','#d1d5da');
        }
    });

    var height;
    var rand;
    $(function () {
        height = $(window).height();
        $('.login_box').height(height);
        $('.forget_box').height(height);
    });
    $('input').focus(function(){
        $(this).next().css('display','none');
    });
    $('input').blur(function(){
        if($(this).val()==''){
            $(this).next().css('display','block');
        }
    });

    //密码显示
    $('.eye').click(function(){
        var img = $(this).children('.img').attr('src');
        if(img == 'icon/eye-lose2@2x.png'){
            $('div.eye>img').attr('src','icon/eye-lose1@2x.png');
            $('.password').attr('type','text');
        }else if(img == 'icon/eye-lose1@2x.png'){
            $('div.eye>img').attr('src','icon/eye-lose2@2x.png');
            $('.password').attr('type','password');
        }
    });

    $('.register').click(function(){
        $('.login_box').addClass("miss");
        $('.register_box').removeClass("miss");
//            console.log(document.title)
        document.title = '注册';
//            alert(document.title)
    })
    $('.forget_pass').click(function(){
        $('.login_box').addClass("miss");
        $('.changePassword').removeClass("miss");
//            console.log(document.title)
        document.title = '修改密码';
//            alert(document.title)
    })
    $('.button_next').click(function(){
        var phoneW=$('#login_name').val()
        var passW=$('#login_password').val()
        localStorage.setItem('passW',passW);
        localStorage.setItem('phoneW',phoneW);
        var userPhone = $('#login_name').val();
        var userPassword = $('#login_password').val();
//            var verifyCode = $('#register_code').val();
        if(userPassword != ''&&userPhone != ''){
            $.ajax( {
                type:'POST',
//                    data:$('#register_box').serialize(),
                data:"userPhone="+userPhone+"&userPassword="+userPassword,
                url:'/yichaxun/user/login',
                async:true,
                success: function(result){
                    if(result.code == 0){
//                            alert(result.message);
                        var userCard=result.data.userCard;
                        var userCompany=result.data.userCompany;
                        var userCompanyAddress=result.data.userCompanyAddress;
                        var userEmail=result.data.userEmail;
                        var userHeadImg=result.data.userHeadImg;
                        var userId=result.data.userId;
                        var userRealname=result.data.userRealname;
                        var serviceTel=result.data.serviceTel;

                        console.log(userHeadImg)
                        localStorage.setItem("userCard",userCard);
                        localStorage.setItem("userCompany",userCompany);
                        localStorage.setItem("userCompanyAddress",userCompanyAddress);
                        localStorage.setItem("userEmail",userEmail);
                        localStorage.setItem("userHeadImg",userHeadImg);
                        localStorage.setItem("userId",userId);
                        localStorage.setItem("userRealname",userRealname);
                        localStorage.setItem("serviceTel",serviceTel);
                        localStorage.setItem("userPhone",userPhone);
                        localStorage.setItem("userPassword",userPassword);
                        console.log(userRealname)
                        location.href="index.html"

                    }else{
                        $('.tanchuang1').css('display','block')
                        $('.wenzi').html(result.message)
//                            alert("11111")
//                        alert(result.message);
                    }
                },
                error: function(xhr,msg,reasonString){
                    $('.tanchuang1').css('display','block')
                    $('.wenzi').html('请求错误，请稍后再试...')
//                    alert('请求错误，请稍后再试...');
                    console.log(arguments);
                }
            } )
        }else{
            $('.tanchuang1').css('display','block')
            $('.wenzi').html('请先完成填写')
//            alert('请先完成填写');
        }
    });


</script>
<!--注册界面-->
<script>
    $('.send_Verification_change_a').click(function(){
        var time = 60;
        var me = $(this);
//        $(this).unbind('click')
        $('.send_Verification_change_a').attr({"disabled":true})
//        me.html('60s')
//            var userPhone = $('.userPhone').val();
        var phone = $(this).parent().parent().children().children('.phone').val();
//            rand = randomString();
        if(phone == ''){
            $('.tanchuang1').css('display','block')
            $('.wenzi').html('请先填写手机号')
//            $('.send_Verification_change_a').bind('click')
//            alert('请先填写手机号');
            $('.send_Verification_change_a').attr({"disabled":false});
        }else{
            $.ajax( {
                type:'POST',
                data:"userPhone="+phone,
                url:'/yichaxun/c/sendverifycode',
                async:true,
                success: function(data){
                    if(data.code == 0){
                        var timer = setInterval(function(){
                            time --;
                            me.html(time + ' s');
                            if(time == 0){
                                clearInterval(timer);
                                me.html('获取验证码');
                            }
                        },1000);
                    }else{
//                        $('.send_Verification_change_a').bind('click')
                        $('.send_Verification_change_a').attr({"disabled":false})
                        $('.tanchuang1').css('display','block')
                        $('.wenzi').html(data.message)
//                        alert(data.message);
//                        me.html('获取验证码');
                    }
                },
                error: function(xhr,msg,reasonString){
                    $('.tanchuang1').css('display','block')
                    $('.wenzi').html('请求错误，请稍后再试...')
//                    alert('请求错误，请稍后再试...');
                    console.log(arguments);
                }
            } );
        }
    });

    $('.refresh_login').click(function(){
        location.href="login.html"
    })


    //监听input是否有内容，有内容span取消
    $('input').focus(function(){
        $(this).next().css('display','none');
    });
    $('input').blur(function(){
        if($(this).val()==''){
            $(this).next().css('display','block');
        }
    });
    $(".img_gouxuan").click(function () {
        var img = $(this).attr('src')
        if(img == 'icon/gouxuanwu@2x.png'){
            $('div.gouxuan>img').attr('src','icon/gouxuan@2x.pngg');
            $('.button_register_next').attr({'disabled':false})
        }else if(img == 'icon/gouxuan@2x.png'){
            $('div.gouxuan>img').attr('src','icon/gouxuanwu@2x.png');
            $('.button_register_next').attr('disabled',true)
        }
    })
    //登录注册界面获取焦点
    $('.placeholder_phone').click(function(){
        $('.username').focus();
        $('.phone').focus()
    })
    $('.placeholder_password').click(function(){
        $('.password').focus();
    })
    $('.placeholder_changeVerification_register').click(function(){
        $('.changeVerification_register').focus();
    })

    //注册新用户
    $('.button_register_next').click(function(){
        $('.tanchuang1').css('display','block');
        $('.wenzi').html('正在注册');
        $('.button_register_next').attr({"disabled":true})
//        $(this).unbind('click');
        var userPhone = $('#phone').val();
        var userPassword = $('#password').val();
        var verifyCode = $('#changeVerification_register').val();
//            var verifyCode = $('#register_code').val();
        if(userPassword != ''&&userPhone != ''){
            $.ajax( {
                type:'POST',
                async:true,
//                    data:$('#register_box').serialize(),
                data:"userPhone="+userPhone+"&userPassword="+userPassword+"&verifyCode="+verifyCode,
                url:'/yichaxun/user/register',
                async:true,
                success: function(result){
                    if(result.code == 0){
                        $('.tanchuang1').css('display','none');
//                        $('.tanchuang1').css('display','block')
//                        $('.wenzi').html('注册成功')
//                        alert('注册成功');
                        $.ajax( {
                            type:'POST',
//                    data:$('#register_box').serialize(),
                            data:"userPhone="+userPhone+"&userPassword="+userPassword,
                            url:'/yichaxun/user/login',
                            async:true,
                            success: function(result){
                                if(result.code == 0){
//                            alert(result.message);
                                    location.href="select_role.html"
                                    var userCard=result.data.userCard;
                                    var userCompany=result.data.userCompany;
                                    var userCompanyAddress=result.data.userCompanyAddress;
                                    var userEmail=result.data.userEmail;
                                    var userHeadImg=result.data.userHeadImg;
                                    var userId=result.data.userId;
                                    var userRealname=result.data.userRealname;
                                    var serviceTel=result.data.serviceTel;

                                    console.log(userHeadImg)
                                    localStorage.setItem("userCard",userCard);
                                    localStorage.setItem("userCompany",userCompany);
                                    localStorage.setItem("userCompanyAddress",userCompanyAddress);
                                    localStorage.setItem("userEmail",userEmail);
                                    localStorage.setItem("userHeadImg",userHeadImg);
                                    localStorage.setItem("userId",userId);
                                    localStorage.setItem("userRealname",userRealname);
                                    localStorage.setItem("serviceTel",serviceTel);


                                }else{
//                            alert("11111")
                                    $('.tanchuang1').css('display','block')
                                    $('.wenzi').html(result.message)
                                    $('.button_register_next').attr({"disabled":false})
//                                    alert(result.message);
                                }
                            },
                            error: function(xhr,msg,reasonString){
                                $('.tanchuang1').css('display','block')
                                $('.wenzi').html('请求错误，请稍后再试...')
                                $('.button_register_next').attr({"disabled":false})
//                                alert('请求错误，请稍后再试...');
                                console.log(arguments);
                            }
                        } );
                    }else{
//                            alert("11111")
                        $('.tanchuang1').css('display','block')
                        $('.wenzi').html(result.message)
//                        alert(result.message);
//                        $('.button_register_next').bind('click')
                        $('.button_register_next').attr({"disabled":false})
                    }
                },
                error: function(xhr,msg,reasonString){
                    $('.tanchuang1').css('display','block')
                    $('.wenzi').html('请求错误，请稍后再试...')
                    $('.button_register_next').attr({"disabled":false})
//                    alert('请求错误，请稍后再试...');
                    console.log(arguments);
                }
            } )
        }else{
            $('.tanchuang1').css('display','block')
            $('.button_register_next').attr({"disabled":false})
            $('.wenzi').html('请先完成填写')
//            alert('请先完成填写');
        }
    });
</script>

</body>
</html>