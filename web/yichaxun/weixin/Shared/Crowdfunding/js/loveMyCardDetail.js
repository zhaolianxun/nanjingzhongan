/** * Created by xuxk on 2017/8/24. *///首页界面关爱卡详情里的详细信息//时间转换function _formatDate(nS) {    var datas= new Date(parseInt(nS)).toLocaleString().replace(/:\d{1,2}$/, ' ');    var m="上"    var n="下"    if( datas.split(m)[0].length<12){        return datas.split(m)[0]    }else{        return datas.split(n)[0]    }}function loveCardSelect(keyword){    $.ajax({        url: '/yichaxun/1/u/carecard/entrypage?pageNo=' + 1 + '&pageSize=' + 15,        data:'keyword='+keyword,        type:'get',        async:true,        dataType: 'json',        success: function (data) {            if(data.code==0) {                if(data.data.items.length==0){                    alert("当前没有搜索记录")                }            }        },        error: function (xhr, type) {        }    });}//关键词查询卡function loveCard(keyword){    //var toPageNo    $(function () {        // dropload        var pageSize = 15;        var toPageNo = 0;        $('.loveCardLine').dropload({            scrollArea: window,            loadDownFn: function (me) {                toPageNo++;                // 拼接HTML                var result = '';                $.ajax({                    url: '/yichaxun/1/u/carecard/entrypage?pageNo=' + toPageNo + '&pageSize=' + pageSize,                    data:'keyword='+keyword,                    type:'get',                    async:true,                    dataType: 'json',                    success: function (data) {                      if(data.code==0){                          var arrLen = data.data.items.length;                          console.log(arrLen);                          if (arrLen > 0) {                              for (var i = 0; i < arrLen; i++) {                                  var datastr= data.data.items[i].serviceDesc;                                  var r;                                  var results = '';                                  var c;                                  for(r=0;r<datastr.length;r++){                                      //alert(123)                                      c=datastr.substr(r,1);                                      if(c=='\n'){                                          results=results+'<br/>';                                      }else if(c!='\n'){                                          results=results+c;                                      }                                  }                                  console.log(results)                                  result += '<div class="tableBox" rowId="' + data.data.items[i].rowId + '">'+                                  '<img class="lf" src="'+data.data.items[i].pic+'" alt=""/>'+                                  '<div class="tableBoxRight rt">'+                                  '<p class="title">' + data.data.items[i].title + '</p>'+                                  '<p class="serviceIntro">' + results + '</p>'+                                  '<div class="tableBoxRightBottom">'+                                  '<p class="hospitalName">' + data.data.items[i].hospitalName + '</p>'+                                  '<p class="endTime">有效期：<span>' + _formatDate(parseInt(data.data.items[i].expireTime))+ '</span>' +                                  '<span class="rmbLeft rt">￥<span class="rmb">'+data.data.items[i].price+'</span></span></p>'+                                  '</div>'+                                  '</div>'+                                  '</div>'                              }                              // 如果没有数据                          } else {                              //alert('123121231')                              // 锁定                              me.lock();                              // 无数据                              me.noData();                          }                          // 为了测试，延迟1秒加载                          setTimeout(function () {                              // 插入数据到页面，放到最后面                              $('.loveCardLine').append(result);                              // 每次数据插入，必须重置                              me.resetload();                          }, 100);                      }else if(data.code==20||data.code==26){                          localStorage.setItem('href',location.href);                          location.href="Tlogin.html"                      }else{                          alert(data.message)                      }                    },                    error: function (xhr, type) {//                                    alert('Ajax error!');                        // 即使加载出错，也得重置                        me.resetload();                    }                });            }        });    });}//省市区id查询卡function loveCardCity(province_id,city_id,district_id){    //var toPageNo    $(function () {        // dropload        var pageSize = 15;        var toPageNo = 0;        $('.loveCardLine').dropload({            scrollArea: window,            loadDownFn: function (me) {                toPageNo++;                // 拼接HTML                var result = '';                $.ajax({                    url: '/yichaxun/1/u/carecard/entrypage?pageNo=' + toPageNo + '&pageSize=' + pageSize,                    data:'province_id='+province_id+"&city_id="+city_id+"&district_id="+district_id,                    type:'get',                    async:true,                    dataType: 'json',                    success: function (data) {                        if(data.code==0){                            var arrLen = data.data.items.length;                            console.log(arrLen);                            if (arrLen > 0) {                                for (var i = 0; i < arrLen; i++) {                                    var datastr= data.data.items[i].serviceDesc;                                    var r;                                    var results = '';                                    var c;                                    for(r=0;r<datastr.length;r++){                                        //alert(123)                                        c=datastr.substr(r,1);                                        if(c=='\n'){                                            results=results+'<br/>';                                        }else if(c!='\n'){                                            results=results+c;                                        }                                    }                                    console.log(results)                                    result += '<div class="tableBox" rowId="' + data.data.items[i].rowId + '">'+                                    '<img class="lf" src="'+data.data.items[i].pic+'" alt=""/>'+                                    '<div class="tableBoxRight rt">'+                                    '<p class="title">' + data.data.items[i].title + '</p>'+                                    '<p class="serviceIntro">' + results + '</p>'+                                    '<div class="tableBoxRightBottom">'+                                    '<p class="hospitalName">' + data.data.items[i].hospitalName + '</p>'+                                    '<p class="endTime">有效期：<span>' + _formatDate(parseInt(data.data.items[i].expireTime))+ '</span>' +                                    '<span class="rmb" style="margin-top: -0.13rem">'+data.data.items[i].price+'</span><span class="rmbLeft rt">￥</span></p>'+                                    '</div>'+                                    '</div>'+                                    '</div>'                                }                                // 如果没有数据                            } else {                                //alert('123121231')                                // 锁定                                me.lock();                                // 无数据                                me.noData();                            }                            // 为了测试，延迟1秒加载                            setTimeout(function () {                                // 插入数据到页面，放到最后面                                $('.loveCardLine').append(result);                                // 每次数据插入，必须重置                                me.resetload();                            }, 100);                        }else if(data.code==20||data.code==26){                            localStorage.setItem('href',location.href);                            location.href="Tlogin.html"                        }else{                            alert(data.message)                        }                    },                    error: function (xhr, type) {//                                    alert('Ajax error!');                        // 即使加载出错，也得重置                        me.resetload();                    }                });            }        });    });}//我的关爱卡明细页面加关键词搜索function loveMyCardDetailKeyword(status,keyword){    //var toPageNo    $(function () {        // dropload        var pageSize = 15;        var toPageNo = 0;        $('.loveCardLine').dropload({            scrollArea: window,            loadDownFn: function (me) {                toPageNo++;                // 拼接HTML                var result = '';                $.ajax({                    url: '/yichaxun/1/u/carecard/mycarecardspage?pageNo=' + toPageNo + '&pageSize=' + 5,                    data:'status='+status+"&keyword="+keyword,                    type:'get',                    async:true,                    dataType: 'json',                    success: function (data) {                        if(data.code==0){                            var arrLen = data.data.items.length;                            console.log(arrLen);                            if (arrLen > 0) {                                for (var i = 0; i < arrLen; i++) {                                    var datastr= data.data.items[i].serviceDesc;                                    var r;                                    var results = '';                                    var c;                                    for(r=0;r<datastr.length;r++){                                        //alert(123)                                        c=datastr.substr(r,1);                                        if(c=='\n'){                                            results=results+'<br/>';                                        }else if(c!='\n'){                                            results=results+c;                                        }                                    }                                    result += '<div rowid="' + data.data.items[i].rowId + '" class="box">'+                                    '<div class="selectIcon lf" style="display: none">'+                                    '<img src="Crowdfunding/iconT/icon-select_gray@2x.png" alt=""/>'+                                    '</div>'+                                    '<div class="cardLine">'+                                    '<div class="topLine">'+                                    '<img src="Crowdfunding/iconT/hospital_icon_red@2x.png" alt=""/>'+                                    '<span class="title">' + data.data.items[i].hospitalName + '</span>'+                                    '</div>'+                                    '<div class="bottomLine">'+                                    '<div class="bottomLineLeft ">'+                                    '<div class="bottomLineLeftTop">'+                                    '<p class="textTitle">' + data.data.items[i].title + '</p>'+                                    '<p class="text">' + results + '</p>'+                                    '</div>'+                                    '<div class="bottomLineLeftBottom">'+                                    '<p class="owner">所属人：<span>'+data.data.items[i].owner+'</span></p>'+                                    '<div class="endTime" style="position: static">'+                                    '<p class="lf">有效期：<span>' + _formatDate(parseInt(data.data.items[i].expireTime))+ '</span></p>'+                                    '<p class="sale rt" style="display: none">售价:<span class="doller">￥</span><span class="money">' + data.data.items[i].price + '</span></p>'+                                    '</div>'+                                    '</div>'+                                    '</div>'+                                    '<div class="bottomLineRight ">'+                                    '<img src="'+data.data.items[i].pic+'" alt=""/>'+                                    '</div>'+                                    '</div>'+                                    '</div>'+                                    '</div>'+                                    '<div style="height: 0.26rem;background: #f2f2f2"></div>'                                }                                // 如果没有数据                            } else {                                // 锁定                                me.lock();                                // 无数据                                me.noData();                            }                            // 为了测试，延迟1秒加载                            setTimeout(function () {                                // 插入数据到页面，放到最后面                                $('.loveCardLine').append(result);                                // 每次数据插入，必须重置                                me.resetload();                            }, 100);                        }else if(data.code==20||data.code==26){                            //alert(location.href)                            location.href='Tlogin.html';                            localStorage.setItem("href",location.href)                        }                    },                    error: function (xhr, type) {//                                    alert('Ajax error!');                        // 即使加载出错，也得重置                        me.resetload();                    }                });            }        });    });}//我的关爱卡明细页面function loveMyCardDetail(status){    //var toPageNo    $(function () {        // dropload        var pageSize = 15;        var toPageNo = 0;        $('.loveCardLine').dropload({            scrollArea: window,            loadDownFn: function (me) {                toPageNo++;                // 拼接HTML                var result = '';                $.ajax({                    url: '/yichaxun/1/u/carecard/mycarecardspage?pageNo=' + toPageNo + '&pageSize=' + 5,                    data:'status='+status,                    type:'get',                    async:true,                    dataType: 'json',                    success: function (data) {                        if(data.code==0){                            var arrLen = data.data.items.length;                            console.log(arrLen);                            if (arrLen > 0) {                                for (var i = 0; i < arrLen; i++) {                                    var datastr= data.data.items[i].serviceDesc;                                    var r;                                    var results = '';                                    var c;                                    for(r=0;r<datastr.length;r++){                                        //alert(123)                                        c=datastr.substr(r,1);                                        if(c=='\n'){                                            results=results+'<br/>';                                        }else if(c!='\n'){                                            results=results+c;                                        }                                    }                                    result += '<div rowid="' + data.data.items[i].rowId + '" class="box">'+                                    '<div class="selectIcon lf" style="display: none">'+                                    '<img src="Crowdfunding/iconT/icon-select_gray@2x.png" alt=""/>'+                                    '</div>'+                                    '<div class="cardLine">'+                                    '<div class="topLine">'+                                    '<img src="Crowdfunding/iconT/hospital_icon_red@2x.png" alt=""/>'+                                    '<span class="title">' + data.data.items[i].hospitalName + '</span>'+                                    '</div>'+                                    '<div class="bottomLine">'+                                    '<div class="bottomLineLeft ">'+                                    '<div class="bottomLineLeftTop">'+                                    '<p class="textTitle">' + data.data.items[i].title + '</p>'+                                    '<p class="text">' + results + '</p>'+                                    '</div>'+                                    '<div class="bottomLineLeftBottom">'+                                    '<p class="owner">所属人：<span>'+data.data.items[i].owner+'</span></p>'+                                    '<div class="endTime" style="position: static">'+                                    '<p class="lf">有效期：<span>' + _formatDate(parseInt(data.data.items[i].expireTime))+ '</span></p>'+                                    '<p class="sale rt" style="display: none">售价:<span class="doller">￥</span><span class="money">' + data.data.items[i].price + '</span></p>'+                                    '</div>'+                                    '</div>'+                                    '</div>'+                                    '<div class="bottomLineRight ">'+                                    '<img src="'+data.data.items[i].pic+'" alt=""/>'+                                    '</div>'+                                    '</div>'+                                    '</div>'+                                    '</div>'+                                    '<div style="height: 0.26rem;background: #f2f2f2"></div>'                                }                                // 如果没有数据                            } else {                                // 锁定                                me.lock();                                // 无数据                                me.noData();                            }                            // 为了测试，延迟1秒加载                            setTimeout(function () {                                // 插入数据到页面，放到最后面                                $('.loveCardLine').append(result);                                // 每次数据插入，必须重置                                me.resetload();                            }, 100);                        }else if(data.code==20||data.code==26){                            //alert(location.href)                            location.href='Tlogin.html';                            localStorage.setItem("href",location.href)                        }                    },                    error: function (xhr, type) {//                                    alert('Ajax error!');                        // 即使加载出错，也得重置                        me.resetload();                    }                });            }        });    });}//我的已结束的关爱卡明细页面function loveMyCardDetailEnd(status){    //var toPageNo    $(function () {        // dropload        var pageSize = 15;        var toPageNo = 0;        $('.loveCardLine').dropload({            scrollArea: window,            loadDownFn: function (me) {                toPageNo++;                // 拼接HTML                var result = '';                $.ajax({                    url: '/yichaxun/1/u/carecard/mycarecardspage?pageNo=' + toPageNo + '&pageSize=' + pageSize,                    data:'status='+status,                    type:'get',                    async:true,                    dataType: 'json',                    success: function (data) {                        if(data.code==0){                            var arrLen = data.data.items.length;                            console.log(arrLen);                            if (arrLen > 0) {                                for (var i = 0; i < arrLen; i++) {                                    var datastr= data.data.items[i].serviceDesc;                                    var r;                                    var results = '';                                    var c;                                    for(r=0;r<datastr.length;r++){                                        //alert(123)                                        c=datastr.substr(r,1);                                        if(c=='\n'){                                            results=results+'<br/>';                                        }else if(c!='\n'){                                            results=results+c;                                        }                                    }                                    result += '<div  rowid="' + data.data.items[i].rowId + '" class="box">'+                                    '<div class="selectIcon lf" style="display: none">'+                                    '<img src="Crowdfunding/iconT/icon-select_gray@2x.png" alt=""/>'+                                    '</div>'+                                    '<div class="cardLine">'+                                    '<div class="topLine" >'+                                    '<img   src="Crowdfunding/iconT/hospital_icon_gray@2x.png" alt=""/>'+                                    '<span class="title" style="color: #000;font-size: 0.42rem">' + data.data.items[i].hospitalName + '</span>'+                                    '</div>'+                                    '<div class="bottomLine">'+                                    '<div class="bottomLineLeft ">'+                                    '<div class="bottomLineLeftTop">'+                                    '<p class="textTitle" style="color: #999">' + data.data.items[i].title + '</p>'+                                    '<p class="text">' + results + '</p>'+                                    '</div>'+                                    '<div class="bottomLineLeftBottom">'+                                    '<p class="owner">所属人：<span>'+data.data.items[i].owner+'</span></p>'+                                    '<div class="endTime" style="position: static">'+                                    '<p class="lf">有效期：<span>' + _formatDate(parseInt(data.data.items[i].expireTime))+ '</span></p>'+                                    '<p class="sale rt" style="display: none">售价:<span class="doller">￥</span><span class="money">' + data.data.items[i].price + '</span></p>'+                                    '</div>'+                                    '</div>'+                                    '</div>'+                                    '<div class="bottomLineRight ">'+                                    '<img style="filter:grayscale(100%)"  src="'+data.data.items[i].pic+'" alt=""/>'+                                    '</div>'+                                    '</div>'+                                    '</div>'+                                    '</div>'+                                    '<div style="height: 0.26rem;background: #f2f2f2"></div>'                                }                                // 如果没有数据                            } else {                                // 锁定                                me.lock();                                // 无数据                                me.noData();                            }                            // 为了测试，延迟1秒加载                            setTimeout(function () {                                // 插入数据到页面，放到最后面                                $('.loveCardLine').append(result);                                // 每次数据插入，必须重置                                me.resetload();                            }, 100);                        }else if(data.code==20||data.code==26){                            //alert(location.href)                            location.href='Tlogin.html';                            localStorage.setItem("href",location.href)                        }                    },                    error: function (xhr, type) {//                                    alert('Ajax error!');                        // 即使加载出错，也得重置                        me.resetload();                    }                });            }        });    });}//已售出关爱卡明细function loveMyCardDetailSale(status){    //var toPageNo    $(function () {        // dropload        var pageSize = 15;        var toPageNo = 0;        $('.loveCardLine').dropload({            scrollArea: window,            loadDownFn: function (me) {                toPageNo++;                // 拼接HTML                var result = '';                $.ajax({                    url: '/yichaxun/1/u/carecard/mycarecardspage?pageNo=' + toPageNo + '&pageSize=' + 5,                    data:'status='+status,                    type:'get',                    async:true,                    dataType: 'json',                    success: function (data) {                        if(data.code==0){                            var arrLen = data.data.items.length;                            console.log(arrLen);                            if (arrLen > 0) {                                for (var i = 0; i < arrLen; i++) {                                    var datastr= data.data.items[i].serviceDesc;                                    var r;                                    var results = '';                                    var c;                                    for(r=0;r<datastr.length;r++){                                        //alert(123)                                        c=datastr.substr(r,1);                                        if(c=='\n'){                                            results=results+'<br/>';                                        }else if(c!='\n'){                                            results=results+c;                                        }                                    }                                    result += '<div class="tableBox" rowId="' + data.data.items[i].rowId + '">'+                                    '<img class="lf" src="'+data.data.items[i].pic+'" alt=""/>'+                                    '<div class="tableBoxRight rt">'+                                    '<p class="title">' + data.data.items[i].title + '</p>'+                                    '<p class="serviceIntro">' + results + '</p>'+                                    '<div class="tableBoxRightBottom">'+                                    '<p class="hospitalName">' + data.data.items[i].hospitalName + '</p>'+                                    '<p class="endTime">有效期：<span>' + _formatDate(parseInt(data.data.items[i].expireTime))+ '</span>' +                                    '<span class="rmbLeft rt">￥<span class="rmb">'+data.data.items[i].price+'</span></span></p>'+                                    '</div>'+                                    '</div>'+                                    '</div>'                                }                                // 如果没有数据                            } else {                                // 锁定                                me.lock();                                // 无数据                                me.noData();                            }                            // 为了测试，延迟1秒加载                            setTimeout(function () {                                // 插入数据到页面，放到最后面                                $('.loveCardLine').append(result);                                // 每次数据插入，必须重置                                me.resetload();                            }, 100);                        }else if(data.code==20||data.code==26){                            alert(location.href)                            location.href='Tlogin.html';                            localStorage.setItem("href",location.href)                        }                    },                    error: function (xhr, type) {//                                    alert('Ajax error!');                        // 即使加载出错，也得重置                        me.resetload();                    }                });            }        });    });}//rem自适应var dpr, rem, scale;var docEl = document.documentElement;var fontEl = document.createElement('style');var metaEl = document.querySelector('meta[name="viewport"]');dpr = window.devicePixelRatio || 1;rem = docEl.clientWidth * dpr / 10;//跟换宽度设置offsetWidth 代替clientWidthconsole.log("rem="+ docEl.clientWidth)scale = 1 / dpr;// 设置viewport，进行缩放，达到高清效果metaEl.setAttribute('content', 'width=' + dpr * docEl.clientWidth + ',initial-scale=' + scale + ',maximum-scale=' + scale + ', minimum-scale=' + scale + ',user-scalable=no');// 设置data-dpr属性，留作的css hack之用docEl.setAttribute('data-dpr', dpr);// 动态写入样式docEl.firstElementChild.appendChild(fontEl);fontEl.innerHTML = 'html{font-size:' + rem + 'px!important;}';// 给js调用的，某一dpr下rem和px之间的转换函数window.rem2px = function(v) {    v = parseFloat(v);    return v * rem;};window.px2rem = function(v) {    v = parseFloat(v);    return v / rem;};window.dpr = dpr;window.rem = rem;//时间转换//function _formatDate(nS) {//    var datas= new Date(parseInt(nS)).toLocaleString().replace(/:\d{1,2}$/, ' ');//    var m="上"//    var n="下"//    if( datas.split(m)[0].length<12){//        return datas.split(m)[0]//    }else{//        return datas.split(n)[0]//    }////}//function __formatDate(nS) {//    //alert( new Date(parseInt(nS)).toLocaleString());//    var datas= new Date(parseInt(nS)).toLocaleString().replace(/:\d{1,2}$/, ' ');//    //alert(datas)//    var data_=datas.replace('/','-').replace('/','-');//    var m="上"//    var n="下"//    if( data_.split(m)[0].length<12){//        return data_.split(m)[0]//    }else{//        return data_.split(n)[0]//    }////}//时间转换,适应度比较好function   formatDate(now){    var   now= new Date(now*1000);    var   year=now.getFullYear();    var   month=now.getMonth()+1;    var   date=now.getDate();    var   hour=now.getHours();    var   minute=now.getMinutes();    var   second=now.getSeconds();    return   year+"年"+fixZero(month,2)+"月"+fixZero(date,2)+"日   "+fixZero(hour,2)+":"+fixZero(minute,2)+":"+fixZero(second,2);}function   _formatDate(now){      var   now= new Date(now);    var   year=now.getFullYear();    var   month=now.getMonth()+1;    var   date=now.getDate();    var   hour=now.getHours();    var   minute=now.getMinutes();    var   second=now.getSeconds();    return   year+"/"+fixZero(month,2)+"/"+fixZero(date,2)}function   formatDates(now){      var   now= new Date(now);    var   year=now.getFullYear();    var   month=now.getMonth()+1;    var   date=now.getDate();    var   hour=now.getHours();    var   minute=now.getMinutes();    var   second=now.getSeconds();    return   year+"-"+fixZero(month,2)+"-"+fixZero(date,2)}//时间如果为单位数补0function fixZero(num,length){    var str=""+num;    var len=str.length;    var s="";    for(var i=length;i-->len;){         s+="0";     }    return s+str; }