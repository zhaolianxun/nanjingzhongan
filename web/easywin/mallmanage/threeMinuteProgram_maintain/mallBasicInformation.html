<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>首页广告</title>
    <link rel="stylesheet" href="plugins/layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="css/global.css" media="all">
    <link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/table.css"/>
    <link rel="stylesheet" href="css/mallDetails.css"/>
    <link rel="stylesheet" href="css/index.css"/>
    <script type="text/javascript" src="js/jquery-3.0.0.min.js"></script>
    <script type="text/javascript" src="js/image-file-visible.js"></script>
    <script type="text/javascript" src="plugins/layui/layui.js"></script>
    <script src="js/addTmpImg.js"></script>
    <script src="../../libs/upload.js"></script>
    <script src="../../rxw/rxw.js"></script>
    <script src="../../cropper/cropper.js"></script>
    <link href="../../cropper/cropper.css" rel="stylesheet" />
    <style>#tbody > tr > td > img {
        max-height: 100px;
    }

    .hide {
        display: none
    }

    .serviceType {
        /*border-color: #67c23a;*/
        -webkit-appearance: none;
        background-color: #fff;
        border-radius: 4px;
        border: 1px solid #67c23a;
        box-sizing: border-box;
        color: #5a5e66;
        display: inline-block;
        font-size: inherit;
        height: 40px;
        line-height: 1;
        outline: 0;
        padding: 0 15px;
    }
    #pic2{
        width: 200px;
        height: 200px;
        position: absolute;
        /* top: 10px; */
        /* float: right; */
        /* right: 0; */
        opacity: 0;
        left: 0;
    }

    #image_wrap2 img{
        width: 200px !important;
        height: 200px !important;
    }
    /*.avater_titie{*/
    /*background: url('icon/touxiang.png') no-repeat;*/
    /*width:25%;*/
    /*}*/
    input {
        font-size: 15px !important;
    }
    .userCard_img,
    {
        background: url("images/add.png") no-repeat;
        background-size: 100%;
    }
    </style>
</head>

<body>
<div class="admin-main">

    <!--<blockquote class="layui-elem-quote">-->
    <!--<a href="javascript:;" class="layui-btn layui-btn-small" id="add">-->
    <!--<i class="layui-icon">&#xe608;</i> 添加首页广告-->
    <!--</a>-->
    <!--<a href="javascript:;" class="layui-btn layui-btn-normal layui-btn-small" id="refresh">-->
    <!--<i class="layui-icon">&#x1002;</i> 刷新-->
    <!--</a>-->
    <!--</blockquote>-->
    <fieldset class="btnFT layui-elem-field" style="border: 0">
        <div class="content-wrapper">
            <div class="mall-content content">
                <div class="mall-main el-row">
                    <div class=" btnFT el-col el-col-20">
                        <form class="el-form demo-info" onsubmit="return false">
                            <div class="el-form-item is-success is-required">
                                <!--<label for="name" class="el-form-item__label">店铺名称</label>-->
                                <h5 style="margin-top: 20px;margin-bottom: 20px">一、店铺名称:</h5>
                                <div class="el-form-item__content">
                                    <div class="el-input">
                                        <input autocomplete="off" type="text" rows="2" validateevent="true" class="name el-input__inner" style="width:184px;">
                                    </div>
                                </div>
                            </div>
                            <div class="el-form-item is-success is-required">
                                <!--<label for="minappCategories" class="el-form-item__label">服务类型</label>-->
                                <h5 style="margin-top: 20px;margin-bottom: 20px">二、服务类型:</h5>
                                <div class="el-form-item__content">
                                    <div class="layui-form-item" style="margin: 10px 0 10px;;">
                                        <!--请选择服务类型 <span style="color: red">(两个类型都需要选择)</span>：-->
                                        <!--<select id="provinceId">-->
                                            <!--<option value=" " selected="">——请选择总类型——</option>-->
                                        <!--</select>-->

                                        <!--<select id="cityId">-->
                                            <!--<option value=" " selected="">——请选择分类型——</option>-->
                                        <!--</select>-->
                                        <input  autocomplete="off" type="text" rows="2" validateevent="true"  class="serviceType"/>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <form id="userCard" class="userCard">
                            <h5 style="margin-top: 20px;margin-bottom: 20px">三、请上传图片:</h5><span style="color: red !important;font-size: 12px;line-height: 20px;">上传图片jpg，png，jpeg格式，最大1M</span>
                            <div class="mingpian rt" >
                                <input id="pic2" name="file" type="file" style="cursor:pointer"/>
                                <div id="image_wrap2" class="lf userCard_img" >
                                    <img class="lf userCard_img_1"   src="images/add.png" />
                                </div>

                            </div>
                        </form>
                        <!--<form class="cd-form " id="pic1">-->
                            <!--<div class="fieldset el-form-item is-success is-required">-->
                                <!--<h5 style="margin-top: 20px;margin-bottom: 20px">三、请上传图片:</h5>-->
                                <!--<div class="input" id="image_wrap1" ></div>-->
                                <!--<div class="picDiv  ">-->
                                    <!--<input   name="file"  type="file" class=" has-border" id="pic"  placeholder="上传图片"/>-->
                                    <!--&lt;!&ndash;<span style="margin: -80px 0 0 290px;position: absolute" class="caution"></span>&ndash;&gt;-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</form>-->

                        <div class="btnF el-col el-col-6" >
                            <input  type="button" class="btn" style="margin-top:20px;width: 50px;height: 30px;background:#67c23a;color: #FFFFFF;z-index: 999"  value="确定" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </fieldset>

    <div class="admin-table-page">
        <div id="page" class="page"></div>
    </div>
</div>

<!--<script src="js/metisMenu.min.js"></script>-->
<!--<script src="js/custom.js"></script>-->
<!--<script src="js/oss-api.js"></script>-->

<script>
    rxw1.relativePath='../../'
    var pic2 = {};
$('#pic2').click(function(){

        rxw1.cutImg({
            complete: function (params) {
                pic2.canvas = params.canvas;
                pic2.input = params.input;
                params.canvas.toBlob(function (blob) {
                    if(blob.size > 1*1024*1024)
                        rxw1.errorpad('请选择1M以下的图片')
                    pic2.blob = blob;
                })
                $('.userCard_img_1').attr('src', params.canvas.toDataURL(params.input.type));


            }, xRadio: 1, yRadio: 1
        })

        event.preventDefault();

})
    var token=  localStorage.getItem("token");
    var  mall_id= localStorage.getItem("mall_id");
    var totalPage;
    var adId = '';
    var adTitle = '';
    var adPic = '';
    var adUrl = '';
    var sortNo = '';
    layui.config({
        base: 'plugins/layui/modules/'
    });
    $('.btnFT .btn').on('click',function(){
//        $.addTmpImgYichacha("userCard");
        var leadPic = uploadFileByBlob(rxw1.convertBase64UrlToBlob(pic2.canvas.toDataURL(pic2.input.type)),pic2.input.files[0].name);

        console.log(leadPic)
        var name=$('.name').val();
        var serviceType=$('.serviceType').val()
        if(name == ''){
            layer.msg('店铺名称不能为空！');
        }else if(serviceType == ' '|| serviceType == ' '){
            layer.msg('请选择店铺类型！')
        }else if(leadPic == ' '|| leadPic == ' '){
            layer.msg('请选择店铺图片！')
        }else{
            $.ajax( {
                url: '/easywin/mm/'+mall_id+'/e/baseinfo/alter',
                type: 'POST',
                data: {name:name,headimg:leadPic,service_type:serviceType,good_show_style  :1,token: token},

                success: function(data){
                    if(data.code == 0){
                        alert('修改成功！');
                        history.go(-1);
                    }else if(data.code == 20){
                        layer.msg('登录已失效，请重新登录');
                    }else{
                        layer.msg(data.message);
                    }
                }
            } )
        }

        console.log(123)
    })
    layui.use(['icheck', 'laypage', 'layer'], function () {
        var $ = layui.jquery,
                laypage = layui.laypage,
                layer = parent.layer === undefined ? layui.layer : parent.layer;

        $.ajax({
            type: 'POST',
            data: {token: token},
            url: '/easywin/mm/'+mall_id+'/e/baseinfo/get',
            success: function (data) {
                if (data.code == 0) {
                    $('.el-input__inner').val(data.data.name);
                    if(data.data.headimg){
                        $('.userCard_img_1').attr('src',data.data.headimg)
                    }

//                    $('.userCard_img_1').append('<img src="'+data.data.headimg+'" style="width: 200px; height: 200px;">');
                    $('.serviceType').val(data.data.serviceType)
                } else if (data.code == 20) {
                    alert('登录已失效，请重新登录！！');
//                    window.parent.location.href = 'login.html';
                } else {
                    layer.msg(data.message);
                }
            }
        });

//        /mm/{mallId}/e/baseinfo/alter
//        good_show_style  首页推荐商品展示样式。1：横2列  2：横1列  3：竖
//        name
//        headimg
//        service_type    文字说明





//var introductionLeadpic='';
//        layui.upload({
//            url: 'passion.njshangka.com/oss/file/upload',
//            elem: '#introductionLeadpic',
//            method: 'post',
//            success: function(res){
//                if(res.code == 0){
//                    introductionLeadpic = res.data.url;
//                    layer.msg('封面图片上传成功...')
//                }
//            }
//        });

        $(document).ready(function () {
//图片显示插件
            $.imageFileVisible({
                wrapSelector: "#image_wrap1",
                fileSelector: "#pic",
                width: 200,
                height: 200
            });
            $.imageFileVisible({
                wrapSelector: "#image_wrap2",
                fileSelector: "#pic2",
                width: 200,
                height: 200
            });
        });
    });


</script>
</body>

</html>