<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3分钟平台</title>
    <link rel="stylesheet" href="css/login.css">
    <script type="text/javascript" src="libs/default.js"></script>

</head>
<body style="background:url('images/bg.png') 0 0 no-repeat">


    <div class="loginBox">
        <div class="loginBg">
            <p class="loginText">账号登录</p>
            <div class="inputBox">
                <input type="text" name="phone" placeholder="手机号">
            </div>
            <div class="inputBox">
                <input type="password" name="password" placeholder="密码">
            </div>
            <div class="inputBox submitBox">
                <button class="submit btn" onclick="login()">立即登录</button>
                <p class="register">没有账号？<a href="agent1register.html">立即注册</a></p>
            </div>

        </div>
        <p class="tips tipsTop">欢迎加入3分钟平台</p>
        <p class="tips">联系电话：025-68620547</p>
    </div>

    <script src="libs/jquery.min.js"></script>
    <script src="libs/shake.js"></script>
    <script>
        if(!sessionStorage.webconfig){
            $.getJSON('../webconfig.json',function(data){
                        sessionStorage.webconfig=data;
                    }
            );
        }

        sessionStorage.setItem("agentId","465891232500");
        $(function(){
            //回车快捷登录
            $(document).keypress(function(e) {
                if(e.which == 13) {
                    $(".submit").click();
                }
            });

            $('[name="phone"]').focus(function(){
                $('[name="phone"]').css('border','1px solid #ccc')
            });
            $('[name="password"]').focus(function(){
                $('[name="password"]').css('border','1px solid #ccc')
            });
        });
        function login(){
            var phone = $('[name="phone"]').val();
            var password = $('[name="password"]').val();
            if(phone == ''){
                $('[name="phone"]').css('border','1px solid red');
                $('[name="phone"]').shake(2,10,400);
            }else if(password == ''){
                $('[name="password"]').css('border','1px solid red');
                $('[name="password"]').shake(2,10,400);
            }else{
                $.ajax({
                    type: 'POST',
                    async: false,
                    data: {phone: phone ,password : password},
                    url: '/easywin/p/useraction/login',
                    success: function(res){
                        if(res.code == 0){
                            var token = res.data.token;
                            sessionStorage.setItem('token',token);
                            localStorage.setItem('name',phone);
                            $.ajax({
                                type: 'POST',
                                async: false,
                                url: '/easywin/p/useraction/selfinfo?token='+token,
                                success: function(res){
                                    if(res.code == 0){
                                        localStorage.setItem('superadminIs',res.data.superadminIs);
                                        localStorage.setItem('agentIs',res.data.agentIs);
                                        location.href = 'index.html';
                                    }else{
                                        alert(res.codeMsg);
                                    }
                                }
                            });
                        }else{
                            alert(res.codeMsg);
                            $('[name="phone"]').val('').focus();
                            $('[name="password"]').val('');
                        }
                    }
                })
            }
        }
    </script>
</body>
</html>